# Ch5. HTTP 웹 서버

## Virtual Host(가상호스트)

물리적으로는 서버가 1대지만 가상으로 여러대가 있는 것처럼 설정할 수 있다.

HTTP를 사용해서 클라이언트가 서버에 엑세스할 때 호스트명이나 도메인명이 사용된다.

- 인터넷에서 도메인명은 DNS에 의해 IP주소로 변환된 후 엑세스한다.
- 결국 Request 서버에 도착한 시점에는 IP주소를 기준으로 엑세스하게 된다.

이 때 한대의 서버 안에 `www.t.kr`,`www.p.kr` 두개의 도메인이 있는 경우 어느쪽에 대한 엑세스인지 알 수 없다.

따라서 HTTP Request를 보낼 때

- 호스트명, 도메인명을 완전하게 포함한 URI를 지정하거나
- 반드시 Host 헤더 필드에서 지정해야한다.

## 통신을 중계

1. 프록시
2. 게이트웨이
3. 터널

### 1. 프록시

> 클라이언트 - 프록시 - 서버

- 클라이언트로부터 받은 Request를 다른 서버(리소스 본체를 가진 서버, Origin 서버)에 전송한다.
- HTTP 통신을 할 때 프록시 서버를 여러대 경유하는 것도 가능하다.

프록시 서버를 사용하는 이유

- 캐시를 사용해서 네트워크 대역을 효율적으로 사용할 수 있다.
- 특정 웹 사이트에 대한 엑세스를 제한할 수 있다.
- 엑세스 로그를 획득하려는 목적으로 사용될 수도 있다.

프록시의 사용

1. 캐시하는지/안하는지 -> Caching Proxy
	- 프록시에 이전과 같은 리소스에 대한 Request가 온 경우, Origin 서버까지 가지 않고 프록시가 갖고있던 캐시를 Response로 되돌려준다.

2. 메시지를 변경하는지/안하는지 -> Transparent Proxy

### 2. 게이트웨이

> 클라이언트 - 게이트웨이 - 서버

- 게이트웨이의 동작은 프록시와 매우 유사하다. 단, 게이트웨이의 경우 **다음에 있는 서버가 HTTP 서버 이외의 서비스를 제공하는 서버가 된다.**

게이트웨이를 사용하는 이유

- 클라이언트&게이트웨이 사이를 암호화해서 -> 안전성을 높일 수 있다.

게이트웨이의 사용

- DB에 접속해서 SQL쿼리를 가지고 데이터를 얻는 곳에 이용할 수 있다.
- 쇼핑몰에서 신용카드 결제시스템을 연계할 때 사용되기도 한다.

### 3. 터널

- 요구에 따른 통신경로를 확립한다.

터널의 특징

- 터널 자체는 HTTP Request를 해석하려고 하지 않는다. 그냥 Request를 그대로 다음 서버에 중계한다.
- 통신하고있는 양쪽 끝의 접속이 끊어지면 종료된다.

터널의 사용

- 클라이언트에서 SSL같은 암호화를 통해 서버와 안전하게 통신할 수 있도록 -> 통신경로를 확립한다.

## 캐시

캐시를 사용하면

- 리소스를 가진 서버에 엑세스를 줄일 수 있다. -> 통신량, 통신시간을 절약할 수 있다.

캐시서버의 장점

- 같은 데이터를 몇번이고 Origin 서버에 전송할 필요가 없다.
- 그래서 **클라이언트는** 네트워크에서 가까운 서버로부터 리소스를 얻을 수 있고,
- **서버는** 같은 리퀘스트를 매번 처리하지 않아도 된다.

캐시의 유효기간 

- Origin 서버의 원래 리소스가 갱신되었는데, 캐시서버는 계속해서 이전의 리소스를 그대로 갖고있다?
- 이러면 안되니까 캐시의 유효기간을 지정해주고, 캐시 유효기간이 지나면 
	- Origin 서버에 리소스의 유효성을 확인하러 가거나,
	- 새로운 리소스를 다시 획득하러 간다.

클라이언트 측에도 캐시가 있다.

- 클라이언트가 사용하고있는 브라우저에서도 캐시를 가질 수 있다.
- 브라우저가 유효한 캐시를 갖고있는 경우, 서버에 엑세스하지 않고 로컬디스크로부터 불러온다.
- 캐시서버와 마찬가지로, 유효기간이 지나면 
	- Origin 서버에 리소스의 유효성을 확인하러 가거나,
	- 새로운 리소스를 다시 획득하러 간다.